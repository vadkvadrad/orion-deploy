---
- name: Pull latest image
  community.docker.docker_image:
    name: "{{ docker_image_name }}"
    tag: "{{ docker_image_tag }}"
    source: pull
    force_source: true

- name: Stop and remove existing container if exists (by name)
  shell: |
    if docker ps -a --format '{{ '{{' }}.Names{{ '}}' }}' | grep -q "^{{ actual_container_name }}$"; then
      docker stop {{ actual_container_name }} || true
      docker rm {{ actual_container_name }} || true
    fi
  become: true
  failed_when: false
  changed_when: false

